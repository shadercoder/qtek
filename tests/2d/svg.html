<html>
<head>
    <title></title>
    <meta charset="utf-8">
    <script type="text/javascript" src="../../thirdparty/require.js"></script>
</head>
<body>
    <div id="Main"></div>
    <script type="text/javascript">
        requirejs.config({
            'baseUrl' : '../../src',
            'paths' : {
                '_' : '../thirdparty/lodash.compat',
                'glmatrix' : '../thirdparty/gl-matrix'
            },
            'shim' : {
                '_' : {
                    exports : '_'
                }
            }
        })

        require(['qtek',
                'text!../tests/2d/assets/tiger.svg'], function(qtek, svgData){
            var qtek2d = qtek['2d'];

            var svgLoader = new qtek.loader.SVG();
            var node = svgLoader.parse(svgData);

            var container = document.getElementById("Main");
            var stage = new qtek.Stage({
                container : container,
                width : 1024,
                height : 600
            });
            var layer = stage.create2DLayer();
            layer.picking = new qtek2d.picking.Pixel();
            layer.picking.resize(layer.renderer.width, layer.renderer.height);

            layer.scene.add(node);
            node.style = new qtek2d.Style({
                // globalCompositeOperation : 'xor'
            });

            var canvas = layer.canvas;
            
            // Bounding box
            var bbHelpers = [];
            console.profile("compute bounding box");
            node.traverse(function(current){
                if(current instanceof qtek2d.shape.SVGPath){
                    current.computeBoundingBox();
                    var bb = current.boundingBox;
                    var rect = new qtek2d.shape.Rectangle({
                        start : bb.min,
                        fill : false,
                        stroke : true,
                        style : new qtek2d.Style({
                            stroke : 'black',
                            lineWidth : 0.5
                        }),
                        size : bb.max.clone().sub(bb.min),
                        enablePicking : false
                    });
                    bbHelpers.push(rect);

                    // current.add(rect);
                }
            });
            console.profileEnd("compute bounding box");

            console.profile("render");
            stage.render();
            console.profileEnd("render");

            layer.scene.on("mouseover", function(e){
                e.target.style.shadow = '0 0 10 black';
                e.target.z = 1;
                stage.render();
            });
            layer.scene.on("mouseout", function(e){
                e.target.style.shadow = null;
                e.target.z = 0;
                stage.render();
            });

            layer.picking.setPrecision(0.5);

            document.body.appendChild(layer.picking._canvas);
        });
    </script>
</body>
</html>